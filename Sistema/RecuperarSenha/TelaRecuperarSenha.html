<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de login</title>
    <link rel="stylesheet" href="../../StylePadrao.css">
</head>
<body>
    
    <form id="formulario" action="" method="get">
        <h1>Recuperação de senha</h1>
        <div class="barraHorizontal"></div>

        <div class="campoInput">
            <label for="cpf">Confirme o CPF:</label>
            <input id="cpf" name="cpf" required>
        </div>

        <div class="campoInput">
            <label for="senha1">Nova senha:</label>
            <input type="password" id="senha1" name="senha1" required>
        </div>

        <div class="campoInput">
            <label for="senha">Confirmar nova senha:</label>
            <input type="password" id="senha" name="senha" required>
        </div>

        <div class="exibirSenha">
            <input type="checkbox" id="mostrarSenha">
            <label for="mostrarSenha">Exibir senha</label>
        </div>

        <button type="submit">Cadastrar nova senha</button>
        <button onclick="window.location.href='../Login/Login.html'">Voltar</button>
    </form>
</body>
    <script type="module">
    import { atualizarDados } from '../../Controle/ClienteControle.js';
    import { validarCPF } from '../../Suporte/Verificadores.js';
    function validarSenha(verificarSenha) {
    if (verificarSenha.length < 8) {
        alert("A senha deve ter 8 caracteres.");
        return false;
    }
    if (!/[A-Z]/.test(verificarSenha)) {
        alert("A senha deve conter pelo menos uma letra maiúscula.");
        return false;
    }
    if (!/[a-z]/.test(verificarSenha)) {
        alert("A senha deve conter pelo menos uma letra minúscula.");
        return false;
    }
    if (!/[0-9]/.test(verificarSenha)) {
        alert("A senha deve conter pelo menos um número.");
        return false;
    }
    if (!/[^A-Za-z0-9]/.test(verificarSenha)) {
        alert("A senha deve conter pelo menos um símbolo especial (ex: @, #, !, %).");
        return false;
    }
    return true; // passou em todos os critérios
    }
    document.getElementById('formulario').addEventListener('submit', function(event) {
        event.preventDefault();
        const verificarSenha = document.getElementById('senha').value;
        const cpf = document.getElementById('cpf').value;
        if(!validarCPF(cpf)){
            alert("CPF inválido")
            return;
        }
        if (!validarSenha(verificarSenha)) {
                return;
        }
        atualizarDados(cpf, verificarSenha);
    });
    const mostrarSenha = document.getElementById("mostrarSenha");
    mostrarSenha.addEventListener("change", function () {
        const senha1 = document.getElementById("senha1");
        const senha2 = document.getElementById("senha");

        if (this.checked) {
            senha1.type = "text";
            senha2.type = "text";
        } else {
            senha1.type = "password";
            senha2.type = "password";
        }
    });
</script>

</html>